<script>
    const GITHUB_REPO = "DominicoDeMatte/DominicoDeMatte.github.io"; // Replace with your repository
    const FILE_PATH = "questions.json"; // JSON file storing questions
    const GITHUB_TOKEN = "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"; // Replace with your PAT

    let questionBank = [];

    async function fetchQuestions() {
      try {
        const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${FILE_PATH}`, {
          headers: {
            Authorization: `Bearer ${GITHUB_TOKEN}`,
          },
        });
        if (!response.ok) throw new Error("Failed to fetch questions");
        const fileData = await response.json(); // Fix: Corrected response parsing
        const content = atob(fileData.content); // Decode Base64 content
        questionBank = JSON.parse(content);
        updateAdminList();
      } catch (error) {
        console.error("Error fetching questions:", error);
        alert("Failed to load questions. Please try again later.");
      }
    }

    async function saveQuestions() {
      try {
        const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${FILE_PATH}`, {
          headers: {
            Authorization: `Bearer ${GITHUB_TOKEN}`,
          },
        });
        if (!response.ok) throw new Error("Failed to fetch file metadata");
        const fileData = await response.json(); // Fix: Corrected response parsing
        const updatedContent = btoa(JSON.stringify(questionBank, null, 2)); // Encode content to Base64

        await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${FILE_PATH}`, {
          method: "PUT",
          headers: {
            Authorization: `Bearer ${GITHUB_TOKEN}`,
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            message: "Update question bank",
            content: updatedContent,
            sha: fileData.sha, // Required for updates
          }),
        });
      } catch (error) {
        console.error("Error saving questions:", error);
        alert("Failed to save questions. Please try again later.");
      }
    }
</script>
